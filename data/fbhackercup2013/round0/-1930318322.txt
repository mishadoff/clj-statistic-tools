#!/usr/bin/env python3

import fnmatch
import os

def readfile():
    files = fnmatch.filter(os.listdir(), '*.txt')
    assert len(files) == 1
    with open(files[0], 'rb') as f:
        return [i.strip() for i in f.readlines()[1:]]

COLON_STATE, NO_COLON_STATE = range(2)

def balanced(s):
    s1 = {0}
    state = NO_COLON_STATE
    for i in s:
        if i in b':':
            state = COLON_STATE
        else:
            if ord('a') <= i <= ord('z') or i in b' ':
                pass
            elif i in b'()':
                if i in b'(':
                    s2 = {i + 1 for i in s1}
                elif i in b')':
                    s2 = {i - 1 for i in s1 if i > 0}
                else:
                    assert False

                if state == COLON_STATE:
                    s1.update(s2)
                else:
                    s1 = s2
            else:
                assert False
            state = NO_COLON_STATE
    return 0 in s1

inputfile = readfile()

with open('../saida_b.txt', 'w') as f:
    for x, s in enumerate(inputfile, 1):
        saida = 'Case #{x:d}: {res:s}\n'.format(x=x, res=['NO', 'YES'][balanced(s)])
        f.write(saida)
        print(saida, end='')
